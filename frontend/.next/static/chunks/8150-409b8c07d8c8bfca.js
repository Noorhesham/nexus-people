"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8150],{48150:function(e,a,s){s.r(a),s.d(a,{default:function(){return _id_Profile}});var n=s(85893),d=s(10586),r=s(50720),l=s(44224),i=s(25662),o=s(61903),t=s(93946),c=s(57709),m=s(87109),h=s(72450),u=s(22961),x=s(94054),w=s(33841),p=s(85945),j=s(67294),Z=s(18972),g=s(79475),v=s(86896),b=s(44012),f=s(32216),C=s(31955),N=s(82175),P=s(16310),y=s(87066),_=s(27484),k=s.n(_),S=s(5616),q=s(39043),D=s(16628),M=s(12806),B=s(84808),A=s(35443),O=s(15861),E=s(67720),components_PasswordChanger=e=>{let{open:a,close:s,apiEndPoint:d}=e,{isRTL:r}=(0,j.useContext)(g.O),[l,o]=(0,j.useState)(!1),{user:p,logout:Z}=(0,j.useContext)(A.V),[f,_]=(0,j.useState)(!1),{formatMessage:k}=(0,v.Z)(),[F,z]=(0,j.useState)({oldPassword:"",newPassword:"",repeat_password:""}),R=P.Ry({oldPassword:P.Z_().required(k({id:"required.password"})),newPassword:P.Z_().required(k({id:"required.password"})).min(8,k({id:"password.min.length"})).matches(/^(?=.*[a-zA-Z])(?=.*\d)(?=.*[@$!%*#?&])[A-Za-z\d@$!%*#?&]/,k({id:"password.requirements"})).notOneOf([P.iH("oldPassword"),null],k({id:"newPassword.same.as.old"})),repeat_password:P.Z_().required(k({id:"required.password"})).oneOf([P.iH("newPassword")],k({id:"passwords.must.match"}))}),ChangePassword=async(e,a)=>{let{resetForm:s}=a;R.validate(e).then(async()=>{try{await y.Z.put("".concat(d),F,{headers:{token:C.Z.get("token")}}).then(()=>{Z(C.Z.get("token"),!1),z({oldPassword:"",newPassword:"",repeat_password:""}),closeEditPassword()})}catch(e){}})},closeEditPassword=()=>{o(!1)},handleClickShowPassword=()=>_(e=>!e),handleMouseDownPassword=e=>{e.preventDefault()};return(0,n.jsx)(q.Z,{"aria-labelledby":"transition-modal-title","aria-describedby":"transition-modal-description",open:a,onClose:s,closeAfterTransition:!0,slots:{backdrop:B.Z},slotProps:{backdrop:{timeout:500}},children:(0,n.jsx)(D.Z,{in:a,children:(0,n.jsxs)(S.Z,{className:"space-y-8",sx:W,children:[(0,n.jsx)("div",{className:"flex mb-8 flex-row-reverse w-60 sm:w-full ",children:(0,n.jsx)(M.Z,{className:"relative right-0 hover:text-primary cursor-pointer",onClick:s})}),(0,n.jsx)("div",{className:"flex justify-center space-y-2",children:(0,n.jsx)(E.Z,{variant:"fullWidth",className:"w-full",children:(0,n.jsx)(O.Z,{variant:"h6",children:(0,n.jsx)(b.Z,{id:"form.changePassword"})})})}),(0,n.jsx)(N.J9,{initialValues:F,validationSchema:R,onSubmit:ChangePassword,children:e=>{let{isValid:a,dirty:s}=e;return(0,n.jsxs)(N.l0,{dir:r?"rtl":"ltr",className:"w-60 sm:w-96 space-y-4",children:[(0,n.jsxs)(x.Z,{variant:"outlined",className:"w-full",children:[(0,n.jsx)(w.Z,{htmlFor:"oldPassword",children:(0,n.jsx)(b.Z,{id:"form.current"})}),(0,n.jsx)(N.gN,{name:"oldPassword",children:e=>{let{field:a,meta:s}=e;return(0,n.jsx)(c.Z,{id:"oldPassword",type:f?"text":"password",...a,onChange:e=>{null==a||a.onChange(e),z(a=>({...a,oldPassword:e.target.value}))},endAdornment:(0,n.jsx)(m.Z,{position:"end",children:(0,n.jsx)(t.Z,{"aria-label":"toggle password visibility",onClick:handleClickShowPassword,onMouseDown:handleMouseDownPassword,edge:"end",children:f?(0,n.jsx)(h.Z,{}):(0,n.jsx)(u.Z,{})})}),label:(0,n.jsx)(b.Z,{id:"form.current"})})}}),(0,n.jsx)(N.Bc,{name:"oldPassword",component:"div",className:"text-red-500"})]}),(0,n.jsxs)(x.Z,{variant:"outlined",className:"w-full",children:[(0,n.jsx)(w.Z,{htmlFor:"newPassword",children:(0,n.jsx)(b.Z,{id:"form.new"})}),(0,n.jsx)(N.gN,{name:"newPassword",children:e=>{let{field:a,meta:s}=e;return(0,n.jsx)(c.Z,{id:"newPassword",type:f?"text":"password",...a,onChange:e=>{null==a||a.onChange(e),z(a=>({...a,newPassword:e.target.value}))},endAdornment:(0,n.jsx)(m.Z,{position:"end",children:(0,n.jsx)(t.Z,{"aria-label":"toggle password visibility",onClick:handleClickShowPassword,onMouseDown:handleMouseDownPassword,edge:"end",children:f?(0,n.jsx)(h.Z,{}):(0,n.jsx)(u.Z,{})})}),label:(0,n.jsx)(b.Z,{id:"form.new"})})}}),(0,n.jsx)(N.Bc,{name:"newPassword",component:"div",className:"text-red-500"})]}),(0,n.jsxs)(x.Z,{variant:"outlined",className:"w-full",children:[(0,n.jsx)(w.Z,{htmlFor:"repeat_password",children:(0,n.jsx)(b.Z,{id:"form.confirm"})}),(0,n.jsx)(N.gN,{name:"repeat_password",children:e=>{let{field:a,meta:s}=e;return(0,n.jsx)(c.Z,{id:"repeat_password",type:f?"text":"password",...a,onChange:e=>{null==a||a.onChange(e),z(a=>({...a,repeat_password:e.target.value}))},endAdornment:(0,n.jsx)(m.Z,{position:"end",children:(0,n.jsx)(t.Z,{"aria-label":"toggle password visibility",onClick:handleClickShowPassword,onMouseDown:handleMouseDownPassword,edge:"end",children:f?(0,n.jsx)(h.Z,{}):(0,n.jsx)(u.Z,{})})}),label:(0,n.jsx)(b.Z,{id:"form.confirm"})})}}),(0,n.jsx)(N.Bc,{name:"repeat_password",component:"div",className:"text-red-500"})]}),(0,n.jsx)(i.Z,{type:"submit",variant:"contained",className:"bg-secondary w-full text-white hover:bg-primary py-2",disabled:!a||!s,children:(0,n.jsx)(b.Z,{id:"form.changePassword"})})]})}})]})})})};let W={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",borderRadius:"20px",bgcolor:"background.paper",boxShadow:24,p:4};var _id_Profile=e=>{let{render:a,ProfileData:s,apiEndpoint:_,HandleModal:S}=e,{isRTL:q}=(0,j.useContext)(g.O),[D,M]=(0,j.useState)(!1),[B,O]=(0,j.useState)(!1),[E,W]=(0,j.useState)(!1),{user:F,fetchUser:z,updateUser:R}=(0,j.useContext)(A.V),{formatMessage:V}=(0,v.Z)(),Y=P.Ry({name:P.Ry().shape({en:P.Z_().min(5,V({id:"name.short"})).required(V({id:"required.nameEn"})),ar:P.Z_().min(5,V({id:"name.short"})).required(V({id:"required.nameAr"}))}),gender:P.Z_().required(V({id:"required.gender"})),DOB:P.hT().required(V({id:"required.dob"})),email:P.Z_().email(V({id:"contact.email.invalid"})).required(V({id:"contact.email.error"})),phone:P.Z_().required(V({id:"required.phone"})),password:P.Z_().required(V({id:"required.password"})).min(8,V({id:"password.min"})).matches(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]/,V({id:"password.complexity"})),address:P.Z_().required(V({id:"required.address"}))}),{handleSubmit:$,handleInputChange:I,handleEdit:U}=(0,f.Z)({apiEndpoint:"".concat("https://nexusbhub.com/backend/")}),handleClickShowPassword=()=>O(e=>!e),handleMouseDownPassword=e=>{e.preventDefault()},handleSubmitData=async(e,a)=>{let{resetForm:s}=a;try{let a=await y.Z.post("".concat("https://nexusbhub.com/backend/","auth/admin/checkEmail"),{email:e.email});"User already exists"===a.data.Error?W(!0):a.data.exists||(await Y.validate(e),await $(_,!1,C.Z.get("token")).then(()=>{W(!1),S()}))}catch(e){console.error("Validation error:",e)}};(0,j.useEffect)(()=>{(null==F?void 0:F.role)!=="admin"&&U(null==F?void 0:F._id)},[]);let handleUpdateData=async()=>{await U(null==F?void 0:F._id).then(async()=>{await $("".concat("https://nexusbhub.com/backend/").concat(null==F?void 0:F.role),!1,C.Z.get("token")).then(()=>{z(C.Z.get("token"))})})};return(0,n.jsxs)("div",{dir:q?"rtl":"ltr",className:"space-y-4 min-h-96",children:[a&&(null==F?void 0:F.provider)==="System"?(0,n.jsx)("div",{className:"w-full flex justify-end",children:(0,n.jsx)(i.Z,{onClick:()=>{M(!0)},className:"bg-primary",variant:"contained",children:(0,n.jsx)(b.Z,{id:"form.changePassword"})})}):null,(0,n.jsx)(N.J9,{validateOnMount:!0,enableReinitialize:!0,initialValues:s||{},validationSchema:Y,onSubmit:handleSubmitData,children:e=>{let{isValid:j,dirty:g,setFieldValue:v,resetForm:f}=e;return(0,n.jsxs)(N.l0,{className:"gap-4 md:grid-cols-2 grid w-full",children:[(0,n.jsx)(N.gN,{name:"name[en]",children:e=>{let{field:a,meta:d}=e;return(0,n.jsxs)("div",{children:[(0,n.jsx)(o.Z,{label:(0,n.jsx)(b.Z,{id:"form.name"}),variant:"outlined",fullWidth:!0,...a,disabled:!!s&&(null==F?void 0:F.role)==="admin",onChange:e=>{a.onChange(e),I("name.en",e.target.value,!1)}}),(0,n.jsx)(N.Bc,{name:"name[en]",component:"div",className:"text-red-500"})]})}}),(0,n.jsx)(N.gN,{name:"name[ar]",children:e=>{let{field:a,meta:d}=e;return(0,n.jsxs)("div",{children:[(0,n.jsx)(o.Z,{label:(0,n.jsx)(b.Z,{id:"form.arabicName"}),variant:"outlined",fullWidth:!0,...a,disabled:!!s&&(null==F?void 0:F.role)==="admin",onChange:e=>{a.onChange(e),I("name.ar",e.target.value,!1)}}),(0,n.jsx)(N.Bc,{name:"name[ar]",component:"div",className:"text-red-500"})]})}}),(0,n.jsxs)(x.Z,{fullWidth:!0,children:[(0,n.jsx)(w.Z,{id:"demo-simple-select-label",children:(0,n.jsx)(b.Z,{id:"form.gender"})}),(0,n.jsx)(N.gN,{name:"gender",children:e=>{let{field:a}=e;return(0,n.jsxs)(p.Z,{labelId:"demo-simple-select-label",id:"demo-simple-select",label:(0,n.jsx)(b.Z,{id:"form.gender"}),...a,disabled:!!s&&(null==F?void 0:F.role)==="admin",onChange:e=>{a.onChange(e),I("gender",e.target.value,!1)},children:[(0,n.jsx)(Z.Z,{value:"male",children:(0,n.jsx)(b.Z,{id:"form.male"})}),(0,n.jsx)(Z.Z,{value:"female",children:(0,n.jsx)(b.Z,{id:"form.female"})})]})}}),(0,n.jsx)(N.Bc,{name:"gender",component:"div",className:"text-red-500"})]}),(0,n.jsx)(r._,{dateAdapter:d.y,children:(0,n.jsx)(N.gN,{type:"date",name:"DOB",component:l.M,children:e=>{let{field:a}=e;return(0,n.jsx)(l.M,{format:"DD/MM/YYYY",label:(0,n.jsx)(b.Z,{id:"form.dob"}),className:"w-full",disableFuture:!0,disabled:!!s&&(null==F?void 0:F.role)==="admin",onChange:e=>{v("DOB",k()(e).toISOString()),I("DOB",k()(e).toISOString(),!1)}})}})}),(0,n.jsx)(N.gN,{name:"email",children:e=>{let{field:a,meta:d}=e;return(0,n.jsxs)("div",{children:[(0,n.jsx)(o.Z,{label:(0,n.jsx)(b.Z,{id:"form.email"}),variant:"outlined",fullWidth:!0,...a,disabled:!!s&&(null==F?void 0:F.role)==="admin",onChange:e=>{a.onChange(e),I("email",e.target.value,!1)}}),(0,n.jsx)(N.Bc,{name:"email",component:"div",className:"text-red-500"}),E?(0,n.jsx)("div",{className:"text-red-500",children:"Email Already exists"}):null]})}}),(0,n.jsx)(N.gN,{name:"phone",children:e=>{let{field:a,meta:d}=e;return(0,n.jsxs)("div",{children:[(0,n.jsx)(o.Z,{label:(0,n.jsx)(b.Z,{id:"form.phone"}),variant:"outlined",fullWidth:!0,...a,disabled:!!s&&(null==F?void 0:F.role)==="admin",onChange:e=>{a.onChange(e),I("phone",e.target.value,!1)}}),(0,n.jsx)(N.Bc,{name:"phone",component:"div",className:"text-red-500"})]})}}),(0,n.jsx)(N.gN,{name:"address",children:e=>{let{field:a,meta:d}=e;return(0,n.jsxs)("div",{children:[(0,n.jsx)(o.Z,{label:(0,n.jsx)(b.Z,{id:"form.address"}),variant:"outlined",fullWidth:!0,...a,disabled:!!s&&(null==F?void 0:F.role)==="admin",onChange:e=>{a.onChange(e),I("address",e.target.value,!1)}}),(0,n.jsx)(N.Bc,{name:"address",component:"div",className:"text-red-500"})]})}}),a?(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(i.Z,{onClick:e=>handleUpdateData(),disabled:!j||!g,variant:"contained",className:"bg-secondary md:col-span-2 text-white hover:bg-primary py-2",children:(0,n.jsx)(b.Z,{id:"form.updateProfile"})})}):(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)(x.Z,{variant:"outlined",className:"w-full",children:[(0,n.jsx)(w.Z,{htmlFor:"outlined-adornment-password",children:(0,n.jsx)(b.Z,{id:"form.password"})}),(0,n.jsx)(N.gN,{name:"password",children:e=>{let{field:a,meta:s}=e;return(0,n.jsxs)("div",{children:[(0,n.jsx)(c.Z,{id:"outlined-adornment-password",className:"w-full",...a,onChange:e=>{a.onChange(e),I("password",e.target.value,!1)},type:B?"text":"password",endAdornment:(0,n.jsx)(m.Z,{position:"end",children:(0,n.jsx)(t.Z,{"aria-label":"toggle password visibility",onClick:handleClickShowPassword,onMouseDown:handleMouseDownPassword,edge:"end",children:B?(0,n.jsx)(h.Z,{}):(0,n.jsx)(u.Z,{})})}),label:(0,n.jsx)(b.Z,{id:"form.password"})}),(0,n.jsx)(N.Bc,{name:"password",component:"div",className:"text-red-500"})]})}})]}),(0,n.jsx)(i.Z,{variant:"contained",className:"bg-primary w-full",type:"submit",disabled:!j,children:(0,n.jsx)(b.Z,{id:"admin.new"})})]})]})}}),D?(0,n.jsx)(components_PasswordChanger,{open:D,close:()=>{M(!1)},apiEndPoint:_}):null]})}}}]);